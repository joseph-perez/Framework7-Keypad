/**
 * Framework7 Keypad 1.0.3
 * Keypad plugin extends Framework7 with additional custom keyboards
 * 
 * http://www.idangero.us/framework7/plugins/
 * 
 * Copyright 2017, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 * 
 * Licensed under MIT
 * 
 * Released on: March 30, 2017
 */

Framework7.prototype.plugins.keypad=function(e){"use strict";function a(e){t(e.container).find('input[type="numpad"], input[type="calculator"]').each(function(){var e=t(this);e[0].f7Keypad=new n({input:e,type:e.attr("type"),value:e.val()||0,valueMaxLength:e.attr("maxlength")||void 0,toolbar:"false"===e.attr("data-toolbar")?!1:!0,toolbarCloseText:e.attr("data-toolbarCloseText")||void 0})}),t(e.container).find(".numpad-init, .calculator-init").each(function(){var e,a=t(this);a.hasClass("calculator-init")&&(e="calculator"),a.hasClass("numpad-init")&&(e="numpad"),a[0].f7Keypad=new n({input:a.attr("data-input")||void 0,type:e,value:a.attr("data-value")||void 0,valueMaxLength:input.attr("maxlength")||void 0,toolbar:"false"===input.attr("data-toolbar")?!1:!0,toolbarCloseText:input.attr("data-toolbarCloseText")||void 0})})}var t=window.Dom7,n=(window.Template7,function(a){function n(){var a=!1;return l.params.convertToPopover||l.params.onlyInPopover?(!l.inline&&l.params.input&&(l.params.onlyInPopover?a=!0:e.device.ios?a=e.device.ipad?!0:!1:t(window).width()>=768&&(a=!0)),a):a}function s(){return l.opened&&l.container&&l.container.length>0&&l.container.parents(".popover").length>0?!0:!1}function p(e){if(e.preventDefault(),!l.opened&&(l.open(),l.params.scrollToInput&&!n())){var a=l.input.parents(".page-content");if(0===a.length)return;var t,s=parseInt(a.css("padding-top"),10),p=parseInt(a.css("padding-bottom"),10),r=a[0].offsetHeight-s-l.container.height(),o=a[0].scrollHeight-s-l.container.height(),i=l.input.offset().top-s+l.input[0].offsetHeight;if(i>r){var u=a.scrollTop()+i-r;u+r>o&&(t=u+r-o+p,r===o&&(t=l.container.height()),a.css({"padding-bottom":t+"px"})),a.scrollTop(u,300)}}}function r(e){s()||(l.input&&l.input.length>0?e.target!==l.input[0]&&0===t(e.target).parents(".picker-modal").length&&l.close():0===t(e.target).parents(".picker-modal").length&&l.close())}function o(){l.opened=!1,l.input&&l.input.length>0&&(l.input.parents(".page-content").css({"padding-bottom":""}),e.params.material&&l.input.trigger("blur")),l.params.onClose&&l.params.onClose(l),l.container.find(".picker-items-col").each(function(){l.destroyPickerCol(this)})}var l=this,i={type:"numpad",valueMaxLength:null,dotButton:!0,dotCharacter:".",buttons:function(){var e=a.dotCharacter||".";if("undefined"==typeof a.type||"numpad"===a.type){var t=void 0===a.dotButton?!0:a.dotButton;return[{html:'<span class="picker-keypad-button-number">1</span><span class="picker-keypad-button-letters"></span>',value:1},{html:'<span class="picker-keypad-button-number">2</span><span class="picker-keypad-button-letters">ABC</span>',value:2},{html:'<span class="picker-keypad-button-number">3</span><span class="picker-keypad-button-letters">DEF</span>',value:3},{html:'<span class="picker-keypad-button-number">4</span><span class="picker-keypad-button-letters">GHI</span>',value:4},{html:'<span class="picker-keypad-button-number">5</span><span class="picker-keypad-button-letters">JKL</span>',value:5},{html:'<span class="picker-keypad-button-number">6</span><span class="picker-keypad-button-letters">MNO</span>',value:6},{html:'<span class="picker-keypad-button-number">7</span><span class="picker-keypad-button-letters">PQRS</span>',value:7},{html:'<span class="picker-keypad-button-number">8</span><span class="picker-keypad-button-letters">TUV</span>',value:8},{html:'<span class="picker-keypad-button-number">9</span><span class="picker-keypad-button-letters">WXYZ</span>',value:9},{html:t?'<span class="picker-keypad-button-number">'+e+"</span>":"",value:t?e:void 0,dark:!0,cssClass:t?"":"picker-keypad-dummy-button"},{html:'<span class="picker-keypad-button-number">0</span>',value:0},{html:'<i class="icon icon-keypad-delete"></i>',cssClass:"picker-keypad-delete",dark:!0}]}return"calculator"===a.type?[{html:'<span class="picker-keypad-button-number">C</span>',value:"C",dark:!0},{html:'<span class="picker-keypad-button-number">±</span>',value:"±",dark:!0},{html:'<span class="picker-keypad-button-number">%</span>',value:"%",dark:!0},{html:'<span class="picker-keypad-button-number">÷</span>',value:"÷",cssClass:"calc-operator-button"},{html:'<span class="picker-keypad-button-number">7</span>',value:7},{html:'<span class="picker-keypad-button-number">8</span>',value:8},{html:'<span class="picker-keypad-button-number">9</span>',value:9},{html:'<span class="picker-keypad-button-number">×</span>',value:"×",cssClass:"calc-operator-button"},{html:'<span class="picker-keypad-button-number">4</span>',value:4},{html:'<span class="picker-keypad-button-number">5</span>',value:5},{html:'<span class="picker-keypad-button-number">6</span>',value:6},{html:'<span class="picker-keypad-button-number">-</span>',value:"-",cssClass:"calc-operator-button"},{html:'<span class="picker-keypad-button-number">1</span>',value:1},{html:'<span class="picker-keypad-button-number">2</span>',value:2},{html:'<span class="picker-keypad-button-number">3</span>',value:3},{html:'<span class="picker-keypad-button-number">+</span>',value:"+",cssClass:"calc-operator-button"},{html:'<span class="picker-keypad-button-number">0</span>',value:0,cssClass:"picker-keypad-button-double"},{html:'<span class="picker-keypad-button-number">.</span>',value:e},{html:'<span class="picker-keypad-button-number">=</span>',value:"=",cssClass:"calc-operator-button calc-operator-button-equal"}]:[]}(),closeByOutsideClick:!0,openOnInput:!0,scrollToInput:!0,inputReadOnly:!0,convertToPopover:!0,onlyInPopover:!1,toolbar:!0,toolbarCloseText:"Done",toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"></div><div class="right"><a href="#" class="link close-picker">{{closeText}}</a></div></div></div>'};a=a||{};for(var u in i)"undefined"==typeof a[u]&&(a[u]=i[u]);l.params=a,l.cols=[],l.initialized=!1,l.inline=l.params.container?!0:!1;var c=(e.device.ios||navigator.userAgent.toLowerCase().indexOf("safari")>=0&&navigator.userAgent.toLowerCase().indexOf("chrome")<0&&!e.device.android,[]),d=[],v=!1;return l.calculator=function(e){function a(){for(var e="",a=0;a<d.length;a++){var n=d[a];a===d.length-1&&t.indexOf(n)>=0||n&&("."===n&&(n=0),e+=(n.toString()+"").replace("×","*").replace("÷","/"))}e=e.replace(/--/g,"+"),l.setValue(eval.call(window,e))}var t="+ - = × ÷ ± %".split(" "),n=[0,1,2,3,4,5,6,7,8,9,"."],s="C",p="±",r="%";if(l.value||(l.value=0),e===s)return l.setValue(0),c=[],void(d=[]);if(n.indexOf(e)>=0){if("."===e&&v&&l.value.toString().indexOf(".")>=0)return;l.setValue(t.indexOf(c[c.length-1])>=0?e:l.value?l.value+""+e:e),v=!0}if(t.indexOf(e)>=0)if(e===p){if("."===l.value)return;l.setValue(-1*l.value),v=!0}else if(e===r){if(d[d.length-2]){var o=l.value/100;l.setValue(d[d.length-2]*o)}v=!0}else{var i=d[d.length-1];if("="===e){if("="===d[d.length-1]){if(d.length<2)return;d.pop();var u=d[d.length-2],k=d[d.length-1];d.push(u),d.push(k)}else d.push(l.value);d.push("="),a()}else["-","+","×","÷","="].indexOf(i)>=0?("="===i&&(d=[l.value,e]),["-","+","×","÷"].indexOf(i)>=0&&(v?["-","+"].indexOf(i)>=0&&["×","÷"].indexOf(e)>=0?(d.push(l.value),d.push(e)):(d.push(l.value),d.push(e),a()):d[d.length-1]=e)):(d.push(l.value),d.push(e),a());v=!1}e!==p&&e!==r&&c.push(e)},l.triggerKeyDown=function(e){var a=t(l.input)[0];if(a){var n=new CustomEvent("keydown",{bubbles:!0,cancelable:!0});n.key=e,a.dispatchEvent(n)}},l.triggerKey=function(e){"string"!=typeof e&&(e=e.toString());var a=t(l.input)[0];if(a){var n=e.charCodeAt(0),s=new CustomEvent("keypress",{bubbles:!0,cancelable:!0});s.key=e,s.which=s.keyCode=s.charCode=n,a.dispatchEvent(s)}},l.setValue=function(e){l.updateValue(e)},l.updateValue=function(e){l.value=e,l.params.valueMaxLength&&l.value.length>l.params.valueMaxLength&&(l.value=l.value.substring(0,l.params.valueMaxLength)),l.params.onChange&&l.params.onChange(l,l.value),l.input&&l.input.length>0&&(t(l.input).val(l.params.formatValue?l.params.formatValue(l,l.value):l.value),t(l.input).trigger("change"))},l.initKeypadEvents=function(){function a(e){var a=t(e.target);if(a.hasClass("picker-keypad-button")||(a=a.parents(".picker-keypad-button")),0!==a.length){var s=l.params.buttons[a.index()],p=s.value,r=l.value,o=a.hasClass("picker-keypad-delete"),i=t(l.input)[0];"numpad"===l.params.type&&("undefined"==typeof r&&(r=""),o?r=r.substring(0,r.length-1):"undefined"!=typeof p&&("."===p&&r.indexOf(".")>=0&&(p=""),r+=p),i.hasAttribute("data-mask")?o?l.triggerKeyDown("Backspace"):null!=p&&""!==p&&l.triggerKey(p):"undefined"!=typeof r&&l.setValue(r)),"calculator"===l.params.type&&(l.calculator(s.value),n.find(".calc-operator-active").removeClass("calc-operator-active"),a.hasClass("calc-operator-button")&&!a.hasClass("calc-operator-button-equal")&&a.addClass("calc-operator-active")),"custom"===l.params.type,s.onClick&&s.onClick(l,s)}}var n=l.container.find(".picker-keypad-buttons");n.on(e.touchEvents.start,a),l.container[0].f7DestroyKeypadEvents=function(){n.off(e.touchEvents.start,a)}},l.destroyKeypadEvents=function(e){"f7DestroyKeypadEvents"in l.container[0]&&l.container[0].f7DestroyKeypadEvents()},l.buttonsHTML=function(){for(var e,a,t="",n=0;n<l.params.buttons.length;n++)a=l.params.buttons[n],e="picker-keypad-button",a.dark&&(e+=" picker-keypad-button-dark"),a.cssClass&&(e+=" "+a.cssClass),t+='<span class="'+e+'">'+(a.html||"")+"</span>";return t},l.layout=function(){var e="",a="",t=l.buttonsHTML();a="picker-modal picker-keypad picker-keypad-type-"+l.params.type+" "+(l.params.cssClass||""),e='<div class="'+a+'">'+(l.params.toolbar?l.params.toolbarTemplate.replace(/{{closeText}}/g,l.params.toolbarCloseText):"")+'<div class="picker-modal-inner picker-keypad-buttons">'+t+"</div></div>",l.pickerHTML=e},l.params.input&&(l.input=t(l.params.input),l.input.length>0&&(l.params.inputReadOnly&&l.input.prop("readOnly",!0),!l.inline&&l.params.openOnInput&&l.input.on("click",p),l.params.inputReadOnly&&l.input.on("focus mousedown",function(e){e.preventDefault()}))),!l.inline&&l.params.closeByOutsideClick&&t("html").on("click",r),l.opened=!1,l.open=function(){var a=n();l.opened||(l.layout(),a?(l.pickerHTML='<div class="popover popover-picker-keypad"><div class="popover-inner">'+l.pickerHTML+"</div></div>",l.popover=e.popover(l.pickerHTML,l.params.input,!0),l.container=t(l.popover).find(".picker-modal"),t(l.popover).on("close",function(){o()})):l.inline?(l.container=t(l.pickerHTML),l.container.addClass("picker-modal-inline"),t(l.params.container).append(l.container)):(l.container=t(e.pickerModal(l.pickerHTML)),t(l.container).on("close",function(){o()})),l.container[0].f7Keypad=l,l.initKeypadEvents(),l.initialized?l.value&&l.setValue(l.value):l.params.value&&l.setValue(l.params.value),l.input&&l.input.length>0&&e.params.material&&l.input.trigger("focus")),l.opened=!0,l.initialized=!0,l.params.onOpen&&l.params.onOpen(l)},l.close=function(){return l.opened&&!l.inline?s()?void e.closeModal(l.popover):void e.closeModal(l.container):void 0},l.destroy=function(){l.close(),l.params.input&&l.input.length>0&&l.params.openOnInput&&l.input.off("click focus",p),t("html").off("click",r)},l.inline&&l.open(),l});return e.keypad=function(e){return new n(e)},{hooks:{pageInit:a}}};